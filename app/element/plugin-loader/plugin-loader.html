
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<dom-module id="plugin-loader">
    <script>
        class PluginLoader extends Polymer.Element {

            static get is() { return 'plugin-loader'; }

            ready() {
                super.ready();

                if (!Array.isArray(this.items)) {
                    console.error('No plugin found');
                    return
                }

                this.items.forEach(function (plugin) {

                    this.autoloadConfig(plugin);

                }.bind(this));

                this.dispatchEvent(new CustomEvent('load-plugin', {detail: {kicked: true}}));
            }

            autoloadConfig(plugin) {

                if (plugin.autoload && Array.isArray(plugin.autoload)) {
                    for (let length = 0; plugin.autoload.length > length; length++) {
                        // TODO CONTROLLARE SE ESISTE IL FILE
                        let importClass = require(`${__dirname}/plugin/${plugin.name}/${plugin.autoload[length]}`);
                        global[importClass.name] = importClass;
                    }
                }

                if (plugin.config) {

                    let config = require(`${__dirname}/plugin/${plugin.name}/${plugin.config}`);

                    let pluginConfig = new config(serviceManager);
                    global[pluginConfig.constructor.name] = config;
                    pluginConfig.init();
                }
            }
        }

        window.customElements.define(PluginLoader.is, PluginLoader);

    </script>
</dom-module>