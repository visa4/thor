
<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../../bower_components/paper-input/paper-input.html">

<link rel="import" href="../../../../css/global-layout.html">
<link rel="import" href="../../../../css/global-styles.html">


<dom-module id="playlist-view-list">
  <template>
    <style include="global-layout"></style>
    <style include="global-style"></style>
    <style>

    </style>
    <slot name="header"></slot>
    <div hidden$="{{!notFound}}" style="padding-top: 20px;">
      <template is="dom-repeat" items="[[playlists]]" as="playlist">
        <paper-card class="horizontal">
          <div class="card-content">
            <div class="title">{{playlist.name}}</div>
          </div>
          <div class="card-actions">
            <paper-icon-button
                    icon="app:edit"
                    item="[[playlist]]"
                    on-click="displayUpdateView"
                    class="circle-small"
                    title="Modify">
            </paper-icon-button>
            <paper-icon-button
                    icon="app:remove"
                    item="[[playlist]]"
                    on-click="remove"
                    class="circle-small"
                    title="Delete">
            </paper-icon-button>
          </div>
          <div class="rate-image"></div>
         </paper-card>
      </template>
    </div>
    <div hidden$="{{notFound}}">Non sono presenti monitor virtuali</div>
  </template>

  <script>
    class ElementPlaylistViewList extends Polymer.Element {

      static get is() { return 'playlist-view-list'; }

      static get properties() {
          return {

              playlists: {
                  type: Array,
                  notify: true,
                  value: [],
                  observer: '_playlistChanged'
              },

              playlistSelected: {
                  type: Object,
                  notify: true,
                  value: {}
              },

              selected: {
                  type: Number,
                  notify: true
              },

              notFound: {
                  type:Boolean,
                  notify: true,
                  value: true,
              }
          };
      }

      ready() {
          super.ready();
          this.set('playlists',  serviceManager.get('LocalStoragePluginManager').get(PlaylistConfig.NAME_SERVICE).getAll());
      }

      _playlistChanged(newValue, oldValue) {
          if (oldValue === undefined) {
              return;
          }

          this.hideMonitorNotFound = newValue && Array.isArray(newValue) && newValue.length > 0;
      }

      remove(evt) {

          let index = -1;
          let element = this.playlists.find((element, ind) => {
              if ( element.id === evt.target.item.id) {
                  index = ind;
                  return element;
              }
          });

          if (index < 0 ) {
              return;
          }

          this.splice('playlists', index, 1);
          serviceManager.get('LocalStoragePluginManager')
              .get(PlaylistConfig.NAME_SERVICE)
              .remove(evt.target.item.id);

          serviceManager.get('PaperToastNotification').notify('Remove playlist')
      }

      displayUpdateView(evt) {
          this.playlistSelected = evt.target.item;
          this.selected = 2;
      }
    }

    window.customElements.define(ElementPlaylistViewList.is, ElementPlaylistViewList);

  </script>
</dom-module>
